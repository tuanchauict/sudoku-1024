var Ie=Object.defineProperty;var Ae=(i,e,l)=>e in i?Ie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[e]=l;var I=(i,e,l)=>Ae(i,typeof e!="symbol"?e+"":e,l);import{b as Ne,d as Ve,g as Ee,a as ee,e as oe,i as ie,c as xe,f as ye,L as _e}from"../chunks/BhsYe4nt.js";import{R as ze,w as X,d as H,g as ke}from"../chunks/DzBKrcs7.js";import{t as V,a as k,c as ve,n as Me}from"../chunks/mclcw3TF.js";import{i as K}from"../chunks/BYeF_QUq.js";import{o as fe,aG as De,aH as Pe,s as J,aI as re,D as S,aJ as y,f as ue,aK as de,w as b,x as h,t as T,W as R,g as r,v as F,q as he,y as E,aa as be,aL as Ue,aM as qe,aN as L,ab as Ge}from"../chunks/Dc_OS3HN.js";import{l as Le,w as Te,e as q,s as te,h as He}from"../chunks/DLuECiVk.js";import{p as _,i as ae}from"../chunks/CD5n6-xO.js";import{o as ne}from"../chunks/D4-9260E.js";function O(i,e,l,t,s,o){var n=i.__className;if(fe||n!==l){var c=Ne(l,t,o);(!fe||c!==i.getAttribute("class"))&&(c==null?i.removeAttribute("class"):i.className=c),i.__className=l}else if(o&&s!==o)for(var a in o){var f=!!o[a];(s==null||f!==!!s[a])&&i.classList.toggle(a,f)}return o}function ge(i,e){Le(window,["resize"],()=>Te(()=>e(window[i])))}function je(i){const e=Ve(i);if(e===null||e.length!==81)return null;const l=[];for(let t=0;t<9;t++){const s=[];for(let o=0;o<9;o++)s.push(e[t*9+o]);l.push(s)}return l}function se(i,e){throw new ze(i,e.toString())}new TextEncoder;const Re=({url:i})=>{const e=i.searchParams.get("game");if(!e)throw se(303,ee("/"));const l=parseInt(e[0]);if(isNaN(l)||l<1||l>4)throw se(303,ee("/"));const t=l;if(!t)throw se(303,ee("/"));let s=e.substring(1);const o=s?je(s):null;if(!o)throw s=Ee.generateBoardString(t),se(303,`play?game=${l}${s}`);return{levelId:t,board:o}},Bt=Object.freeze(Object.defineProperty({__proto__:null,load:Re},Symbol.toStringTag,{value:"Module"})),Be=Symbol("sudoku-view-model");function Oe(i){De(Be,i)}function ce(){return Pe(Be)}var Ke=V('<span class="cell-value svelte-akfsra"> </span>'),Je=V('<div class="note-cell svelte-akfsra"><span class="note-value svelte-akfsra"></span></div>'),Fe=V('<div class="notes-grid svelte-akfsra"></div>'),We=V("<div><!></div>");function Ye(i,e){J(e,!1);const l=y();let t=_(e,"rowIndex",8),s=_(e,"colIndex",8),o=_(e,"cellValue",8),n=_(e,"isInitial",8),c=_(e,"notes",8),a=_(e,"selectedCell",8),f=_(e,"valueCounts",8),C=_(e,"violatedCells",8);const v=ce();function w(u,B){return v.isSameBox(u,B)}function m(u,B){return v.hasSameValue(u,B)}re(()=>(ue(C()),ue(t()),ue(s())),()=>{S(l,C().some(u=>u.row===t()&&u.col===s()))}),de(),K();var A=We();let g;var M=b(A);{var D=u=>{var B=Ke(),N=b(B,!0);h(B),T(()=>te(N,o())),k(u,B)},P=u=>{var B=ve(),N=he(B);{var p=G=>{var x=Fe();oe(x,4,()=>Array(9).fill(null),ie,(W,le,Y)=>{var d=ve(),U=he(d);{var Q=Z=>{var $=Je(),z=b($);z.textContent=Y+1,h($),k(Z,$)};ae(U,Z=>{c()[Y]&&Z(Q)})}k(W,d)}),h(x),k(G,x)};ae(N,G=>{c().some(x=>x)&&G(p)})}k(u,B)};ae(M,u=>{o()?u(D):u(P,!1)})}h(A),T(u=>g=O(A,1,"cell svelte-akfsra",null,g,u),[()=>({selected:a().row===t()&&a().col===s(),"same-line":a().row===t()||a().col===s(),"same-box":w(t(),s())&&!(a().row===t()&&a().col===s()),"same-value":m(t(),s())&&!(a().row===t()&&a().col===s()),complete:o()&&f()[o()]>=9,violated:r(l),initial:n()})],R),q("click",A,()=>v.selectCell(t(),s())),k(i,A),F()}var Xe=V("<div><!></div>"),Qe=V('<div class="row svelte-1iqdaqq"></div>'),Ze=V('<div class="sudoku-board svelte-1iqdaqq"></div>');function $e(i,e){J(e,!1);let l=_(e,"board",24,()=>[]),t=_(e,"notes",24,()=>[]),s=_(e,"selectedCell",24,()=>({row:-1,col:-1}));const o=ce();let n=y([]),c=y([]);ne(()=>{const f=o.valueCounts.subscribe(v=>{S(n,v)}),C=o.violatedCells.subscribe(v=>{S(c,v)});return()=>{f(),C()}}),K();var a=Ze();oe(a,5,l,ie,(f,C,v)=>{var w=Qe();oe(w,5,()=>r(C),ie,(m,A,g)=>{var M=Xe();O(M,1,"cell svelte-1iqdaqq",null,{},{"border-bottom-thick":v%3===2&&v<8,"border-right-thick":g%3===2&&g<8});var D=b(M);const P=R(()=>o.isInitial(v,g));Ye(D,{rowIndex:v,colIndex:g,get cellValue(){return r(A)},get isInitial(){return r(P)},get notes(){return t()[v][g]},get selectedCell(){return s()},get valueCounts(){return r(n)},get violatedCells(){return r(c)}}),h(M),k(m,M)}),h(w),k(f,w)}),h(a),k(i,a),F()}var et=Me('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>');function tt(i){var e=et();k(i,e)}var lt=V('<div class="container svelte-1kzvdff"><p class="tip svelte-1kzvdff">Tip: Select a cell and press 1-9 to enter values. Use note mode for candidates.</p> <p class="tip svelte-1kzvdff">Any issue or suggestion? <br>Please report on <a href="https://github.com/tuanchauict/sudoku-1024/" target="_blank">GitHub</a> of the project.</p></div>');function st(i){var e=lt();k(i,e)}var at=Me('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" stroke="none" viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"></path></svg>');function ot(i){var e=at();k(i,e)}var it=V("<button> </button>"),rt=V('<div class="container svelte-1l8nhu6"><div class="digits-container svelte-1l8nhu6"><!> <button class="btn digit-button clear-btn svelte-1l8nhu6"><span>&#10005;</span></button></div> <div class="actions-container svelte-1l8nhu6"><button class="btn action-button svelte-1l8nhu6"><!> <span>Undo</span></button> <button><!> <span>Note</span></button></div> <!></div>');function nt(i,e){J(e,!1);let l=_(e,"digitCounts",24,()=>Array(9).fill(0)),t=y(!1),s=y(!0),o=y(!1);const n=ce();function c(u){n.enterDigit(u)}ne(()=>{const u=n.noteMode.subscribe(p=>{S(t,p)}),B=n.cellEditable.subscribe(p=>{S(s,p)}),N=n.canUndo.subscribe(p=>{S(o,p)});return()=>{u(),B(),N()}}),K();var a=rt(),f=b(a),C=b(f);oe(C,0,()=>Array(9).fill(null),ie,(u,B,N)=>{var p=it();const G=R(()=>N+1),x=R(()=>l()[N]);let W;var le=b(p,!0);h(p),T(Y=>{W=O(p,1,"btn digit-button svelte-1l8nhu6",null,W,Y),p.disabled=r(x)>=9,te(le,r(G))},[()=>({disabled:r(x)>=9})],R),q("click",p,()=>c(r(G))),k(u,p)});var v=E(C,2);h(f);var w=E(f,2),m=b(w),A=b(m);ot(A),be(2),h(m);var g=E(m,2);let M;var D=b(g);tt(D),be(2),h(g),h(w);var P=E(w,2);st(P),h(a),T(u=>{v.disabled=!r(s),m.disabled=!r(o),M=O(g,1,"btn action-button note-btn svelte-1l8nhu6",null,M,u)},[()=>({active:r(t)})],R),q("click",v,()=>n.clearSelectedCell()),q("click",m,()=>n.undo()),q("click",g,()=>n.toggleNoteMode()),k(i,a),F()}const ct="sudoku";class me{static saveCurrentGame(e,l,t){const s={state:l,timePass:t};localStorage.setItem(we(e),JSON.stringify(s))}static loadCurrentGame(e){const l=localStorage.getItem(we(e));if(!l)return null;const t=JSON.parse(l);return t.state?t:null}}function we(i){const e=i.flatMap(l=>l);return`${ct}_${xe(e)}`}function Ce(i){const e=[],l=(t,s)=>e.some(o=>o.row===t&&o.col===s);for(let t=0;t<9;t++)for(let s=0;s<9;s++){const o=i[t][s];if(!o||l(t,s))continue;for(let a=0;a<9;a++)a!==s&&i[t][a]===o&&(l(t,s)||e.push({row:t,col:s}),l(t,a)||e.push({row:t,col:a}));for(let a=0;a<9;a++)a!==t&&i[a][s]===o&&(l(t,s)||e.push({row:t,col:s}),l(a,s)||e.push({row:a,col:s}));const n=Math.floor(t/3)*3,c=Math.floor(s/3)*3;for(let a=n;a<n+3;a++)for(let f=c;f<c+3;f++)(a!==t||f!==s)&&i[a][f]===o&&(l(t,s)||e.push({row:t,col:s}),l(a,f)||e.push({row:a,col:f}))}return e}function pe(i,e){return JSON.stringify(i)===JSON.stringify(e)}function j(i){let e;return i.subscribe(t=>{e=t})(),e}const Se=ye(0,Array(9).fill(Array(9).fill(0)));class ut{constructor(){I(this,"initialBoard",Se.initialBoard);I(this,"state",X(Se));I(this,"stateHistoryStack",[]);I(this,"board");I(this,"notes");I(this,"selectedCell");I(this,"noteMode",X(!1));I(this,"digitCounts");I(this,"valueCounts");I(this,"cellEditable");I(this,"violatedCells");I(this,"gameComplete",X(!1));I(this,"timePass",X(0));I(this,"timeStart",X(Date.now()));I(this,"canUndo",X(!1));this.board=H(this.state,e=>e.board),this.notes=H(this.state,e=>e.notes),this.selectedCell=H(this.state,e=>e.selectedCell),this.digitCounts=H(this.board,e=>this.calculateDigitCounts(e)),this.valueCounts=H(this.board,e=>this.calculateValueCounts(e)),this.cellEditable=H(this.selectedCell,e=>this.isEditableCell(e.row,e.col)),this.violatedCells=H(this.board,e=>Ce(e))}init(e,l){const t=me.loadCurrentGame(l),s=t?t.state:ye(e,l);this.state.set(s),this.initialBoard=l,this.stateHistoryStack.length=0,this.timePass.set(t?t.timePass:0),this.timeStart.set(Date.now())}get isInNodeMode(){return j(this.noteMode)}clearBoard(){this.updateState(e=>({...e,board:this.initialBoard,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),noteMode:!1})),this.gameComplete.set(!1)}selectCell(e,l){this.updateState(t=>({...t,selectedCell:{row:e,col:l}}))}toggleNoteMode(){this.noteMode.set(!this.isInNodeMode)}enterDigit(e){this.updateState(l=>{const{row:t,col:s}=l.selectedCell;if(!this.isEditableCell(t,s))return l;const o=[...l.board.map(c=>[...c])],n=[...l.notes.map(c=>[...c.map(a=>[...a])])];return this.isInNodeMode?n[t][s][e-1]=!n[t][s][e-1]:o[t][s]=e,{...l,board:o,notes:n}}),this.updateCompleteState()}clearSelectedCell(){this.updateState(e=>{const{row:l,col:t}=e.selectedCell;if(!this.isEditableCell(l,t))return e;const s=[...e.board.map(n=>[...n])],o=[...e.notes.map(n=>[...n.map(c=>[...c])])];return s[l][t]!==0?s[l][t]=0:o[l][t]=Array(9).fill(!1),{...e,board:s,notes:o}}),this.gameComplete.set(!1)}undo(){const e=this.stateHistoryStack.pop();e&&this.state.set(e),this.canUndo.set(this.stateHistoryStack.length>0)}isInitial(e,l){return this.initialBoard[e][l]!==0}calculateDigitCounts(e){const l=Array(9).fill(0);for(let t=0;t<9;t++)for(let s=0;s<9;s++)e[t][s]>0&&l[e[t][s]-1]++;return l}calculateValueCounts(e){const l=Array(10).fill(0);for(let t=0;t<9;t++)for(let s=0;s<9;s++)e[t][s]&&l[e[t][s]]++;return l}isSameBox(e,l){const t=j(this.selectedCell);if(!t||t.row===-1||t.col===-1)return!1;const s=Math.floor(e/3),o=Math.floor(l/3),n=Math.floor(t.row/3),c=Math.floor(t.col/3);return s===n&&o===c}hasSameValue(e,l){const t=j(this.selectedCell),s=j(this.board);if(!t||!s||t.row===-1||t.col===-1)return!1;const o=s[t.row][t.col];return!!(o&&s[e][l]===o)}isEditableCell(e,l){return e===-1||l===-1?!1:this.initialBoard[e][l]===0}updateCompleteState(){const e=j(this.board);if(!e.every(s=>s.every(o=>o>0))){this.gameComplete.set(!1);return}if(Ce(e).length>0){this.gameComplete.set(!1);return}this.gameComplete.set(!0)}updateState(e){this.state.update(l=>{const t=e(l),s=j(this.timeStart),o=j(this.timePass)+(Date.now()-s)/1e3;return me.saveCurrentGame(this.initialBoard,t,o),pe(l.board,t.board)&&pe(l.notes,t.notes)||(this.stateHistoryStack.push({...l,selectedCell:t.selectedCell}),this.canUndo.set(!0)),t})}}var dt=V('<div class="overlay svelte-5jfzgt"><div class="complete-card svelte-5jfzgt"><h2 class="svelte-5jfzgt">Puzzle Completed!</h2> <p class="svelte-5jfzgt"> </p> <button class="new-game-btn svelte-5jfzgt">New Game</button></div></div>');function vt(i,e){J(e,!1);let l=_(e,"levelId",8);function t(){ke(ee("/"))}K();var s=dt(),o=b(s),n=E(b(o),2),c=b(n);h(n);var a=E(n,2);h(o),h(s),T(()=>te(c,`Congratulations! You've successfully completed the ${l()??""} puzzle.`)),q("click",a,t),k(i,s),F()}var ft=V('<div class="header svelte-1eechvy"><button class="back-btn svelte-1eechvy">Back</button> <div class="title svelte-1eechvy"><h1 class="svelte-1eechvy"> </h1> <h2 class="svelte-1eechvy"> </h2></div> <button class="clear-btn svelte-1eechvy">Reset</button></div>');function ht(i,e){J(e,!1);const l=y();let t=_(e,"levelId",8);const s=ce();let o=y(0);function n(){ke(ee("/"))}function c(){s.clearBoard()}ne(()=>{const M=setInterval(()=>{Ue(o)},1e3),D=s.timePass.subscribe(P=>{S(o,P)});return()=>{clearInterval(M),D()}}),re(()=>r(o),()=>{S(l,new Date(r(o)*1e3).toISOString().substr(11,8))}),de(),K();var a=ft(),f=b(a),C=E(f,2),v=b(C),w=b(v,!0);h(v);var m=E(v,2),A=b(m,!0);h(m),h(C);var g=E(C,2);h(a),T(()=>{te(w,_e[t()].name),te(A,r(l))}),q("click",f,n),q("click",g,c),k(i,a),F()}var bt=V('<div><!> <div><div><!></div> <div class="controls-container svelte-1lnc43"><!></div></div> <!></div>');function gt(i,e){J(e,!1);const l=y();let t=_(e,"levelId",8),s=_(e,"initialBoard",8);const o=new ut;o.init(t(),s()),Oe(o);let n=y([]),c=y([]),a=y({row:-1,col:-1}),f=y(Array(9).fill(0)),C=y(!1),v=y(!1),w=y(0),m=y(0);ne(()=>{const d=o.board.subscribe(z=>{S(n,z)}),U=o.notes.subscribe(z=>{S(c,z)}),Q=o.selectedCell.subscribe(z=>{S(a,z)}),Z=o.digitCounts.subscribe(z=>{S(f,z)}),$=o.gameComplete.subscribe(z=>{S(C,z)});return()=>{d(),U(),Q(),Z(),$()}});function A(d){if(!r(C))if(d.key.match(/[1-9]/)){const U=parseInt(d.key,10);o.enterDigit(U)}else d.key==="Backspace"?o.clearSelectedCell():d.key==="Enter"?o.toggleNoteMode():d.key==="ArrowUp"?g(-1,0):d.key==="ArrowDown"?g(1,0):d.key==="ArrowLeft"?g(0,-1):d.key==="ArrowRight"?g(0,1):d.key==="z"&&(d.ctrlKey||d.metaKey)&&o.undo()}function g(d,U){r(a).row===-1||r(a).col===-1?(L(a,r(a).row=0),L(a,r(a).col=0)):(L(a,r(a).row+=d),L(a,r(a).col+=U)),r(a).row<0&&L(a,r(a).row=8),r(a).row>8&&L(a,r(a).row=0),r(a).col<0&&L(a,r(a).col=8),r(a).col>8&&L(a,r(a).col=0),o.selectCell(r(a).row,r(a).col)}re(()=>(r(w),r(m)),()=>{S(v,r(w)>r(m)||r(w)>650)}),re(()=>(r(m),r(v),r(w)),()=>{S(l,r(m)>0&&!r(v)&&r(w)/r(m)>.65)}),de(),K();var M=bt();q("keydown",qe,A);let D;var P=b(M);ht(P,{get levelId(){return t()}});var u=E(P,2);let B;var N=b(u);let p;var G=b(N);$e(G,{get board(){return r(n)},get notes(){return r(c)},get selectedCell(){return r(a)}}),h(N);var x=E(N,2),W=b(x);nt(W,{get digitCounts(){return r(f)}}),h(x),h(u);var le=E(u,2);{var Y=d=>{vt(d,{get levelId(){return t()}})};ae(le,d=>{r(C)&&d(Y)})}h(M),T((d,U,Q)=>{D=O(M,1,"container svelte-1lnc43",null,D,d),B=O(u,1,"game-content svelte-1lnc43",null,B,U),p=O(N,1,"board-container svelte-1lnc43",null,p,Q)},[()=>({"wide-layout":r(v)}),()=>({"wide-layout":r(v)}),()=>({"square-layout":r(l)})],R),ge("innerWidth",d=>S(w,d)),ge("innerHeight",d=>S(m,d)),k(i,M),F()}function It(i,e){J(e,!1);let l=_(e,"data",8);K(),He(t=>{T(()=>Ge.title=`Sudoku 1024: ${_e[l().levelId].name??""}`)}),gt(i,{get levelId(){return l().levelId},get initialBoard(){return l().board}}),F()}export{It as component,Bt as universal};
