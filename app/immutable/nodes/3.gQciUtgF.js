var _e=Object.defineProperty;var ye=(i,e,s)=>e in i?_e(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var N=(i,e,s)=>ye(i,typeof e!="symbol"?e+"":e,s);import{b as Se,d as ke,g as Be,a as Q,e as le,i as se,c as Me,L as Ce}from"../chunks/Dq8OeWCa.js";import{R as Ae,w as ie,d as T,g as we}from"../chunks/Nqy5hpNx.js";import{t as I,a as S,c as ve,n as Ne}from"../chunks/mclcw3TF.js";import{i as H}from"../chunks/BYeF_QUq.js";import{o as fe,aG as Ie,aH as xe,s as F,aI as ae,D as B,aJ as y,f as ne,aK as ce,w as m,x as b,t as j,W as O,g as r,v as K,q as he,y as E,aa as Ve,aL as Ee,aM as ze,aN as q,ab as Pe}from"../chunks/Dc_OS3HN.js";import{l as De,w as Ge,e as L,s as Z,h as qe}from"../chunks/DLuECiVk.js";import{p as _,i as te}from"../chunks/CD5n6-xO.js";import{o as oe}from"../chunks/D4-9260E.js";function U(i,e,s,t,a,l){var c=i.__className;if(fe||c!==s){var u=Se(s,t,l);(!fe||u!==i.getAttribute("class"))&&(u==null?i.removeAttribute("class"):i.className=u),i.__className=s}else if(l&&a!==l)for(var o in l){var n=!!l[o];(a==null||n!==!!a[o])&&i.classList.toggle(o,n)}return l}function be(i,e){De(window,["resize"],()=>Ge(()=>e(window[i])))}function Le(i){const e=ke(i);if(e===null||e.length!==81)return null;const s=[];for(let t=0;t<9;t++){const a=[];for(let l=0;l<9;l++)a.push(e[t*9+l]);s.push(a)}return s}function ee(i,e){throw new Ae(i,e.toString())}new TextEncoder;const je=({url:i})=>{const e=i.searchParams.get("game");if(!e)throw ee(303,Q("/"));const s=parseInt(e[0]);if(isNaN(s)||s<1||s>4)throw ee(303,Q("/"));const t=s;if(!t)throw ee(303,Q("/"));let a=e.substring(1);const l=a?Le(a):null;if(!l)throw a=Be.generateBoardString(t),ee(303,`play?game=${s}${a}`);return{levelId:t,board:l}},wt=Object.freeze(Object.defineProperty({__proto__:null,load:je},Symbol.toStringTag,{value:"Module"})),pe=Symbol("sudoku-view-model");function Re(i){Ie(pe,i)}function re(){return xe(pe)}var Te=I('<span class="cell-value svelte-akfsra"> </span>'),Oe=I('<div class="note-cell svelte-akfsra"><span class="note-value svelte-akfsra"></span></div>'),Ue=I('<div class="notes-grid svelte-akfsra"></div>'),He=I("<div><!></div>");function Fe(i,e){F(e,!1);const s=y();let t=_(e,"rowIndex",8),a=_(e,"colIndex",8),l=_(e,"cellValue",8),c=_(e,"isInitial",8),u=_(e,"notes",8),o=_(e,"selectedCell",8),n=_(e,"valueCounts",8),h=_(e,"violatedCells",8);const v=re();function w(d,g){return v.isSameBox(d,g)}function C(d,g){return v.hasSameValue(d,g)}ae(()=>(ne(h()),ne(t()),ne(a())),()=>{B(s,h().some(d=>d.row===t()&&d.col===a()))}),ce(),H();var p=He();let M;var k=m(p);{var A=d=>{var g=Te(),x=m(g,!0);b(g),j(()=>Z(x,l())),S(d,g)},P=d=>{var g=ve(),x=he(g);{var R=G=>{var z=Ue();le(z,4,()=>Array(9).fill(null),se,(W,de,$)=>{var f=ve(),D=he(f);{var J=X=>{var Y=Oe(),V=m(Y);V.textContent=$+1,b(Y),S(X,Y)};te(D,X=>{u()[$]&&X(J)})}S(W,f)}),b(z),S(G,z)};te(x,G=>{u().some(z=>z)&&G(R)})}S(d,g)};te(k,d=>{l()?d(A):d(P,!1)})}b(p),j(d=>M=U(p,1,"cell svelte-akfsra",null,M,d),[()=>({selected:o().row===t()&&o().col===a(),"same-line":o().row===t()||o().col===a(),"same-box":w(t(),a())&&!(o().row===t()&&o().col===a()),"same-value":C(t(),a())&&!(o().row===t()&&o().col===a()),complete:l()&&n()[l()]>=9,violated:r(s),initial:c()})],O),L("click",p,()=>v.selectCell(t(),a())),S(i,p),K()}var Ke=I("<div><!></div>"),We=I('<div class="row svelte-1iqdaqq"></div>'),Je=I('<div class="sudoku-board svelte-1iqdaqq"></div>');function Xe(i,e){F(e,!1);let s=_(e,"board",24,()=>[]),t=_(e,"notes",24,()=>[]),a=_(e,"selectedCell",24,()=>({row:-1,col:-1}));const l=re();let c=y([]),u=y([]);oe(()=>{const n=l.valueCounts.subscribe(v=>{B(c,v)}),h=l.violatedCells.subscribe(v=>{B(u,v)});return()=>{n(),h()}}),H();var o=Je();le(o,5,s,se,(n,h,v)=>{var w=We();le(w,5,()=>r(h),se,(C,p,M)=>{var k=Ke();U(k,1,"cell svelte-1iqdaqq",null,{},{"border-bottom-thick":v%3===2&&v<8,"border-right-thick":M%3===2&&M<8});var A=m(k);const P=O(()=>l.initialBoard[v][M]!==0);Fe(A,{rowIndex:v,colIndex:M,get cellValue(){return r(p)},get isInitial(){return r(P)},get notes(){return t()[v][M]},get selectedCell(){return a()},get valueCounts(){return r(c)},get violatedCells(){return r(u)}}),b(k),S(C,k)}),b(w),S(n,w)}),b(o),S(i,o),K()}var Ye=Ne('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>');function Qe(i){var e=Ye();S(i,e)}var Ze=I('<div class="container svelte-1kzvdff"><p class="tip svelte-1kzvdff">Tip: Select a cell and press 1-9 to enter values. Use note mode for candidates.</p> <p class="tip svelte-1kzvdff">Any issue or suggestion? <br>Please report on <a href="https://github.com/tuanchauict/sudoku-1024/" target="_blank">GitHub</a> of the project.</p></div>');function $e(i){var e=Ze();S(i,e)}var et=I("<button> </button>"),tt=I('<div class="container svelte-1txh8u4"><div class="digits-container svelte-1txh8u4"><!> <button class="digit-button clear-btn svelte-1txh8u4"><span>&#10005;</span></button></div> <div class="actions-container svelte-1txh8u4"><button><!> <span>Note</span></button></div> <!></div>');function lt(i,e){F(e,!1);let s=_(e,"digitCounts",24,()=>Array(9).fill(0)),t=y(!1),a=y(!0);const l=re();function c(A){l.enterDigit(A)}function u(){l.toggleNoteMode()}oe(()=>{const A=l.noteMode.subscribe(d=>{B(t,d)}),P=l.cellEditable.subscribe(d=>{B(a,d)});return()=>{A(),P()}}),H();var o=tt(),n=m(o),h=m(n);le(h,0,()=>Array(9).fill(null),se,(A,P,d)=>{var g=et();const x=O(()=>d+1),R=O(()=>s()[d]);let G;var z=m(g,!0);b(g),j(W=>{G=U(g,1,"digit-button svelte-1txh8u4",null,G,W),g.disabled=r(R)>=9,Z(z,r(x))},[()=>({disabled:r(R)>=9})],O),L("click",g,()=>c(r(x))),S(A,g)});var v=E(h,2);b(n);var w=E(n,2),C=m(w);let p;var M=m(C);Qe(M),Ve(2),b(C),b(w);var k=E(w,2);$e(k),b(o),j(A=>{v.disabled=!r(a),p=U(C,1,"action-button note-btn svelte-1txh8u4",null,p,A)},[()=>({active:r(t)})],O),L("click",v,()=>l.clearSelectedCell()),L("click",C,u),S(i,o),K()}const st="sudoku";class ge{static saveCurrentGame(e,s,t){const a={state:s,timePass:t};localStorage.setItem(me(e),JSON.stringify(a))}static loadCurrentGame(e){const s=localStorage.getItem(me(e));if(!s)return null;const t=JSON.parse(s);return t.state?t:null}}function me(i){const e=i.flatMap(s=>s);return`${st}_${Me(e)}`}class ue{constructor(e,s){N(this,"state");N(this,"board");N(this,"notes");N(this,"selectedCell");N(this,"noteMode",ie(!1));N(this,"digitCounts");N(this,"valueCounts");N(this,"cellEditable");N(this,"violatedCells");N(this,"gameComplete",ie(!1));N(this,"timePass");N(this,"timeStart",Date.now());this.levelId=e,this.initialBoard=s;const t=ge.loadCurrentGame(s),a=t?t.state:ue.createState(s);this.timePass=t?t.timePass:0,this.state=ie(a),this.board=T(this.state,l=>l.board),this.notes=T(this.state,l=>l.notes),this.selectedCell=T(this.state,l=>l.selectedCell),this.digitCounts=T(this.board,l=>this.calculateDigitCounts(l)),this.valueCounts=T(this.board,l=>this.calculateValueCounts(l)),this.cellEditable=T(this.selectedCell,l=>this.isEditableCell(l.row,l.col)),this.violatedCells=T(this.board,l=>this.findViolatedCells(l))}static createState(e){return{board:e,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),selectedCell:{row:-1,col:-1}}}get isInNodeMode(){let e=!1;return this.noteMode.subscribe(t=>{e=t})(),e}get currentSelectedCell(){let e={row:-1,col:-1};return this.selectedCell.subscribe(t=>{e=t})(),e}get currentBoard(){let e=this.initialBoard;return this.board.subscribe(t=>{e=t})(),e}clearBoard(){this.updateState(e=>({...e,board:this.initialBoard,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),selectedCell:{row:-1,col:-1},noteMode:!1})),this.gameComplete.set(!1)}selectCell(e,s){this.updateState(t=>({...t,selectedCell:{row:e,col:s}}))}toggleNoteMode(){this.noteMode.set(!this.isInNodeMode)}enterDigit(e){this.updateState(s=>{const{row:t,col:a}=s.selectedCell;if(!this.isEditableCell(t,a))return s;const l=[...s.board.map(u=>[...u])],c=[...s.notes.map(u=>[...u.map(o=>[...o])])];return this.isInNodeMode?c[t][a][e-1]=!c[t][a][e-1]:l[t][a]=e,{...s,board:l,notes:c}}),this.updateCompleteState()}clearSelectedCell(){this.updateState(e=>{const{row:s,col:t}=e.selectedCell;if(!this.isEditableCell(s,t))return e;const a=[...e.board.map(c=>[...c])],l=[...e.notes.map(c=>[...c.map(u=>[...u])])];return a[s][t]!==0?a[s][t]=0:l[s][t]=Array(9).fill(!1),{...e,board:a,notes:l}}),this.gameComplete.set(!1)}calculateDigitCounts(e){const s=Array(9).fill(0);for(let t=0;t<9;t++)for(let a=0;a<9;a++)e[t][a]>0&&s[e[t][a]-1]++;return s}calculateValueCounts(e){const s=Array(10).fill(0);for(let t=0;t<9;t++)for(let a=0;a<9;a++)e[t][a]&&s[e[t][a]]++;return s}isSameBox(e,s){const t=this.currentSelectedCell;if(!t||t.row===-1||t.col===-1)return!1;const a=Math.floor(e/3),l=Math.floor(s/3),c=Math.floor(t.row/3),u=Math.floor(t.col/3);return a===c&&l===u}hasSameValue(e,s){const t=this.currentSelectedCell,a=this.currentBoard;if(!t||!a||t.row===-1||t.col===-1)return!1;const l=a[t.row][t.col];return!!(l&&a[e][s]===l)}isEditableCell(e,s){return e===-1||s===-1?!1:this.initialBoard[e][s]===0}findViolatedCells(e){const s=[],t=(a,l)=>s.some(c=>c.row===a&&c.col===l);for(let a=0;a<9;a++)for(let l=0;l<9;l++){const c=e[a][l];if(!c||t(a,l))continue;for(let n=0;n<9;n++)n!==l&&e[a][n]===c&&(t(a,l)||s.push({row:a,col:l}),t(a,n)||s.push({row:a,col:n}));for(let n=0;n<9;n++)n!==a&&e[n][l]===c&&(t(a,l)||s.push({row:a,col:l}),t(n,l)||s.push({row:n,col:l}));const u=Math.floor(a/3)*3,o=Math.floor(l/3)*3;for(let n=u;n<u+3;n++)for(let h=o;h<o+3;h++)(n!==a||h!==l)&&e[n][h]===c&&(t(a,l)||s.push({row:a,col:l}),t(n,h)||s.push({row:n,col:h}))}return s}updateCompleteState(){const e=this.currentBoard;if(!e.every(a=>a.every(l=>l>0))){this.gameComplete.set(!1);return}if(this.findViolatedCells(e).length>0){this.gameComplete.set(!1);return}this.gameComplete.set(!0)}updateState(e){this.state.update(s=>{const t=e(s),a=this.timePass+(Date.now()-this.timeStart)/1e3;return ge.saveCurrentGame(this.initialBoard,t,a),t})}}var at=I('<div class="overlay svelte-5jfzgt"><div class="complete-card svelte-5jfzgt"><h2 class="svelte-5jfzgt">Puzzle Completed!</h2> <p class="svelte-5jfzgt"> </p> <button class="new-game-btn svelte-5jfzgt">New Game</button></div></div>');function ot(i,e){F(e,!1);let s=_(e,"levelId",8);function t(){we(Q("/"))}H();var a=at(),l=m(a),c=E(m(l),2),u=m(c);b(c);var o=E(c,2);b(l),b(a),j(()=>Z(u,`Congratulations! You've successfully completed the ${s()??""} puzzle.`)),L("click",o,t),S(i,a),K()}var rt=I('<div class="header svelte-1eechvy"><button class="back-btn svelte-1eechvy">Back</button> <div class="title svelte-1eechvy"><h1 class="svelte-1eechvy"> </h1> <h2 class="svelte-1eechvy"> </h2></div> <button class="clear-btn svelte-1eechvy">Reset</button></div>');function it(i,e){F(e,!1);const s=y();let t=_(e,"levelId",8);const a=re();let l=y(a.timePass);function c(){we(Q("/"))}function u(){a.clearBoard()}oe(()=>{const k=setInterval(()=>{Ee(l)},1e3);return()=>{clearInterval(k)}}),ae(()=>r(l),()=>{B(s,new Date(r(l)*1e3).toISOString().substr(11,8))}),ce(),H();var o=rt(),n=m(o),h=E(n,2),v=m(h),w=m(v,!0);b(v);var C=E(v,2),p=m(C,!0);b(C),b(h);var M=E(h,2);b(o),j(()=>{Z(w,Ce[t()].name),Z(p,r(s))}),L("click",n,c),L("click",M,u),S(i,o),K()}var nt=I('<div><!> <div><div><!></div> <div class="controls-container svelte-1lnc43"><!></div></div> <!></div>');function ct(i,e){F(e,!1);const s=y();let t=_(e,"levelId",8),a=_(e,"initialBoard",8);const l=new ue(t(),a());Re(l);let c=y([]),u=y([]),o=y({row:-1,col:-1}),n=y(Array(9).fill(0)),h=y(!1),v=y(!1),w=y(0),C=y(0);oe(()=>{const f=l.board.subscribe(V=>{B(c,V)}),D=l.notes.subscribe(V=>{B(u,V)}),J=l.selectedCell.subscribe(V=>{B(o,V)}),X=l.digitCounts.subscribe(V=>{B(n,V)}),Y=l.gameComplete.subscribe(V=>{B(h,V)});return()=>{f(),D(),J(),X(),Y()}});function p(f,D){r(o).row===-1||r(o).col===-1?(q(o,r(o).row=0),q(o,r(o).col=0)):(q(o,r(o).row+=f),q(o,r(o).col+=D)),r(o).row<0&&q(o,r(o).row=8),r(o).row>8&&q(o,r(o).row=0),r(o).col<0&&q(o,r(o).col=8),r(o).col>8&&q(o,r(o).col=0),l.selectCell(r(o).row,r(o).col)}function M(f){if(!r(h))if(f.key.match(/[1-9]/)){const D=parseInt(f.key,10);l.enterDigit(D)}else f.key==="Backspace"?l.clearSelectedCell():f.key==="Enter"?l.toggleNoteMode():f.key==="ArrowUp"?p(-1,0):f.key==="ArrowDown"?p(1,0):f.key==="ArrowLeft"?p(0,-1):f.key==="ArrowRight"&&p(0,1)}ae(()=>(r(w),r(C)),()=>{B(v,r(w)>r(C))}),ae(()=>(r(C),r(v),r(w)),()=>{B(s,r(C)>0&&!r(v)&&r(w)/r(C)>.65)}),ce(),H();var k=nt();L("keydown",ze,M);let A;var P=m(k);it(P,{get levelId(){return t()}});var d=E(P,2);let g;var x=m(d);let R;var G=m(x);Xe(G,{get board(){return r(c)},get notes(){return r(u)},get selectedCell(){return r(o)}}),b(x);var z=E(x,2),W=m(z);lt(W,{get digitCounts(){return r(n)}}),b(z),b(d);var de=E(d,2);{var $=f=>{ot(f,{get levelId(){return t()}})};te(de,f=>{r(h)&&f($)})}b(k),j((f,D,J)=>{A=U(k,1,"container svelte-1lnc43",null,A,f),g=U(d,1,"game-content svelte-1lnc43",null,g,D),R=U(x,1,"board-container svelte-1lnc43",null,R,J)},[()=>({"wide-layout":r(v)}),()=>({"wide-layout":r(v)}),()=>({"square-layout":r(s)})],O),be("innerWidth",f=>B(w,f)),be("innerHeight",f=>B(C,f)),S(i,k),K()}function pt(i,e){F(e,!1);let s=_(e,"data",8);H(),qe(t=>{j(()=>Pe.title=`Sudoku 1024: ${Ce[s().levelId].name??""}`)}),ct(i,{get levelId(){return s().levelId},get initialBoard(){return s().board}}),K()}export{pt as component,wt as universal};
