var Se=Object.defineProperty;var ke=(r,e,l)=>e in r?Se(r,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[e]=l;var I=(r,e,l)=>ke(r,typeof e!="symbol"?e+"":e,l);import{b as Me,d as Be,g as Ae,a as $,e as ae,i as oe,c as Ie,f as Ce,L as pe}from"../chunks/ne2ukbq1.js";import{R as Ne,w as Z,d as R,g as _e}from"../chunks/B6A8fv2c.js";import{t as N,a as M,c as ve,n as Ve}from"../chunks/mclcw3TF.js";import{i as F}from"../chunks/BYeF_QUq.js";import{o as fe,aG as Ee,aH as je,s as K,aI as ie,D as S,aJ as k,f as ce,aK as de,w as g,x as b,t as T,W as U,g as i,v as W,q as he,y as x,aa as xe,aL as ze,aM as De,aN as G,ab as Pe}from"../chunks/Dc_OS3HN.js";import{l as Ge,w as qe,e as q,s as ee,h as Te}from"../chunks/DLuECiVk.js";import{p as _,i as se}from"../chunks/CD5n6-xO.js";import{o as re}from"../chunks/D4-9260E.js";function H(r,e,l,t,s,a){var c=r.__className;if(fe||c!==l){var d=Me(l,t,a);(!fe||d!==r.getAttribute("class"))&&(d==null?r.removeAttribute("class"):r.className=d),r.__className=l}else if(a&&s!==a)for(var o in a){var n=!!a[o];(s==null||n!==!!s[o])&&r.classList.toggle(o,n)}return a}function be(r,e){Ge(window,["resize"],()=>qe(()=>e(window[r])))}function Le(r){const e=Be(r);if(e===null||e.length!==81)return null;const l=[];for(let t=0;t<9;t++){const s=[];for(let a=0;a<9;a++)s.push(e[t*9+a]);l.push(s)}return l}function le(r,e){throw new Ne(r,e.toString())}new TextEncoder;const Re=({url:r})=>{const e=r.searchParams.get("game");if(!e)throw le(303,$("/"));const l=parseInt(e[0]);if(isNaN(l)||l<1||l>4)throw le(303,$("/"));const t=l;if(!t)throw le(303,$("/"));let s=e.substring(1);const a=s?Le(s):null;if(!a)throw s=Ae.generateBoardString(t),le(303,`play?game=${l}${s}`);return{levelId:t,board:a}},yt=Object.freeze(Object.defineProperty({__proto__:null,load:Re},Symbol.toStringTag,{value:"Module"})),ye=Symbol("sudoku-view-model");function Oe(r){Ee(ye,r)}function ne(){return je(ye)}var Ue=N('<span class="cell-value svelte-akfsra"> </span>'),He=N('<div class="note-cell svelte-akfsra"><span class="note-value svelte-akfsra"></span></div>'),Fe=N('<div class="notes-grid svelte-akfsra"></div>'),Ke=N("<div><!></div>");function We(r,e){K(e,!1);const l=k();let t=_(e,"rowIndex",8),s=_(e,"colIndex",8),a=_(e,"cellValue",8),c=_(e,"isInitial",8),d=_(e,"notes",8),o=_(e,"selectedCell",8),n=_(e,"valueCounts",8),h=_(e,"violatedCells",8);const v=ne();function C(u,m){return v.isSameBox(u,m)}function w(u,m){return v.hasSameValue(u,m)}ie(()=>(ce(h()),ce(t()),ce(s())),()=>{S(l,h().some(u=>u.row===t()&&u.col===s()))}),de(),F();var p=Ke();let A;var B=g(p);{var y=u=>{var m=Ue(),E=g(m,!0);b(m),T(()=>ee(E,a())),M(u,m)},V=u=>{var m=ve(),E=he(m);{var L=P=>{var z=Fe();ae(z,4,()=>Array(9).fill(null),oe,(J,ue,te)=>{var f=ve(),D=he(f);{var Y=X=>{var Q=He(),j=g(Q);j.textContent=te+1,b(Q),M(X,Q)};se(D,X=>{d()[te]&&X(Y)})}M(J,f)}),b(z),M(P,z)};se(E,P=>{d().some(z=>z)&&P(L)})}M(u,m)};se(B,u=>{a()?u(y):u(V,!1)})}b(p),T(u=>A=H(p,1,"cell svelte-akfsra",null,A,u),[()=>({selected:o().row===t()&&o().col===s(),"same-line":o().row===t()||o().col===s(),"same-box":C(t(),s())&&!(o().row===t()&&o().col===s()),"same-value":w(t(),s())&&!(o().row===t()&&o().col===s()),complete:a()&&n()[a()]>=9,violated:i(l),initial:c()})],U),q("click",p,()=>v.selectCell(t(),s())),M(r,p),W()}var Je=N("<div><!></div>"),Ye=N('<div class="row svelte-1iqdaqq"></div>'),Xe=N('<div class="sudoku-board svelte-1iqdaqq"></div>');function Qe(r,e){K(e,!1);let l=_(e,"board",24,()=>[]),t=_(e,"notes",24,()=>[]),s=_(e,"selectedCell",24,()=>({row:-1,col:-1}));const a=ne();let c=k([]),d=k([]);re(()=>{const n=a.valueCounts.subscribe(v=>{S(c,v)}),h=a.violatedCells.subscribe(v=>{S(d,v)});return()=>{n(),h()}}),F();var o=Xe();ae(o,5,l,oe,(n,h,v)=>{var C=Ye();ae(C,5,()=>i(h),oe,(w,p,A)=>{var B=Je();H(B,1,"cell svelte-1iqdaqq",null,{},{"border-bottom-thick":v%3===2&&v<8,"border-right-thick":A%3===2&&A<8});var y=g(B);const V=U(()=>a.isInitial(v,A));We(y,{rowIndex:v,colIndex:A,get cellValue(){return i(p)},get isInitial(){return i(V)},get notes(){return t()[v][A]},get selectedCell(){return s()},get valueCounts(){return i(c)},get violatedCells(){return i(d)}}),b(B),M(w,B)}),b(C),M(n,C)}),b(o),M(r,o),W()}var Ze=Ve('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>');function $e(r){var e=Ze();M(r,e)}var et=N('<div class="container svelte-1kzvdff"><p class="tip svelte-1kzvdff">Tip: Select a cell and press 1-9 to enter values. Use note mode for candidates.</p> <p class="tip svelte-1kzvdff">Any issue or suggestion? <br>Please report on <a href="https://github.com/tuanchauict/sudoku-1024/" target="_blank">GitHub</a> of the project.</p></div>');function tt(r){var e=et();M(r,e)}var lt=N("<button> </button>"),st=N('<div class="container svelte-1j6797t"><div class="digits-container svelte-1j6797t"><!> <button class="digit-button clear-btn svelte-1j6797t"><span>&#10005;</span></button></div> <div class="actions-container svelte-1j6797t"><button><!> <span>Note</span></button></div> <!></div>');function at(r,e){K(e,!1);let l=_(e,"digitCounts",24,()=>Array(9).fill(0)),t=k(!1),s=k(!0);const a=ne();function c(y){a.enterDigit(y)}function d(){a.toggleNoteMode()}re(()=>{const y=a.noteMode.subscribe(u=>{S(t,u)}),V=a.cellEditable.subscribe(u=>{S(s,u)});return()=>{y(),V()}}),F();var o=st(),n=g(o),h=g(n);ae(h,0,()=>Array(9).fill(null),oe,(y,V,u)=>{var m=lt();const E=U(()=>u+1),L=U(()=>l()[u]);let P;var z=g(m,!0);b(m),T(J=>{P=H(m,1,"digit-button svelte-1j6797t",null,P,J),m.disabled=i(L)>=9,ee(z,i(E))},[()=>({disabled:i(L)>=9})],U),q("click",m,()=>c(i(E))),M(y,m)});var v=x(h,2);b(n);var C=x(n,2),w=g(C);let p;var A=g(w);$e(A),xe(2),b(w),b(C);var B=x(C,2);tt(B),b(o),T(y=>{v.disabled=!i(s),p=H(w,1,"action-button note-btn svelte-1j6797t",null,p,y)},[()=>({active:i(t)})],U),q("click",v,()=>a.clearSelectedCell()),q("click",w,d),M(r,o),W()}const ot="sudoku";class me{static saveCurrentGame(e,l,t){const s={state:l,timePass:t};localStorage.setItem(ge(e),JSON.stringify(s))}static loadCurrentGame(e){const l=localStorage.getItem(ge(e));if(!l)return null;const t=JSON.parse(l);return t.state?t:null}}function ge(r){const e=r.flatMap(l=>l);return`${ot}_${Ie(e)}`}const we=Ce(0,Array(9).fill(Array(9).fill(0)));class it{constructor(){I(this,"initialBoard",we.initialBoard);I(this,"state",Z(we));I(this,"board");I(this,"notes");I(this,"selectedCell");I(this,"noteMode",Z(!1));I(this,"digitCounts");I(this,"valueCounts");I(this,"cellEditable");I(this,"violatedCells");I(this,"gameComplete",Z(!1));I(this,"timePass",Z(0));I(this,"timeStart",Z(Date.now()));this.board=R(this.state,e=>e.board),this.notes=R(this.state,e=>e.notes),this.selectedCell=R(this.state,e=>e.selectedCell),this.digitCounts=R(this.board,e=>this.calculateDigitCounts(e)),this.valueCounts=R(this.board,e=>this.calculateValueCounts(e)),this.cellEditable=R(this.selectedCell,e=>this.isEditableCell(e.row,e.col)),this.violatedCells=R(this.board,e=>this.findViolatedCells(e))}init(e,l){const t=me.loadCurrentGame(l),s=t?t.state:Ce(e,l);this.state.set(s),this.initialBoard=l,this.timePass.set(t?t.timePass:0),this.timeStart.set(Date.now())}get isInNodeMode(){return O(this.noteMode)}clearBoard(){this.updateState(e=>({...e,board:this.initialBoard,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),selectedCell:{row:-1,col:-1},noteMode:!1})),this.gameComplete.set(!1)}selectCell(e,l){this.updateState(t=>({...t,selectedCell:{row:e,col:l}}))}toggleNoteMode(){this.noteMode.set(!this.isInNodeMode)}enterDigit(e){this.updateState(l=>{const{row:t,col:s}=l.selectedCell;if(!this.isEditableCell(t,s))return l;const a=[...l.board.map(d=>[...d])],c=[...l.notes.map(d=>[...d.map(o=>[...o])])];return this.isInNodeMode?c[t][s][e-1]=!c[t][s][e-1]:a[t][s]=e,{...l,board:a,notes:c}}),this.updateCompleteState()}clearSelectedCell(){this.updateState(e=>{const{row:l,col:t}=e.selectedCell;if(!this.isEditableCell(l,t))return e;const s=[...e.board.map(c=>[...c])],a=[...e.notes.map(c=>[...c.map(d=>[...d])])];return s[l][t]!==0?s[l][t]=0:a[l][t]=Array(9).fill(!1),{...e,board:s,notes:a}}),this.gameComplete.set(!1)}isInitial(e,l){return this.initialBoard[e][l]!==0}calculateDigitCounts(e){const l=Array(9).fill(0);for(let t=0;t<9;t++)for(let s=0;s<9;s++)e[t][s]>0&&l[e[t][s]-1]++;return l}calculateValueCounts(e){const l=Array(10).fill(0);for(let t=0;t<9;t++)for(let s=0;s<9;s++)e[t][s]&&l[e[t][s]]++;return l}isSameBox(e,l){const t=O(this.selectedCell);if(!t||t.row===-1||t.col===-1)return!1;const s=Math.floor(e/3),a=Math.floor(l/3),c=Math.floor(t.row/3),d=Math.floor(t.col/3);return s===c&&a===d}hasSameValue(e,l){const t=O(this.selectedCell),s=O(this.board);if(!t||!s||t.row===-1||t.col===-1)return!1;const a=s[t.row][t.col];return!!(a&&s[e][l]===a)}isEditableCell(e,l){return e===-1||l===-1?!1:this.initialBoard[e][l]===0}findViolatedCells(e){const l=[],t=(s,a)=>l.some(c=>c.row===s&&c.col===a);for(let s=0;s<9;s++)for(let a=0;a<9;a++){const c=e[s][a];if(!c||t(s,a))continue;for(let n=0;n<9;n++)n!==a&&e[s][n]===c&&(t(s,a)||l.push({row:s,col:a}),t(s,n)||l.push({row:s,col:n}));for(let n=0;n<9;n++)n!==s&&e[n][a]===c&&(t(s,a)||l.push({row:s,col:a}),t(n,a)||l.push({row:n,col:a}));const d=Math.floor(s/3)*3,o=Math.floor(a/3)*3;for(let n=d;n<d+3;n++)for(let h=o;h<o+3;h++)(n!==s||h!==a)&&e[n][h]===c&&(t(s,a)||l.push({row:s,col:a}),t(n,h)||l.push({row:n,col:h}))}return l}updateCompleteState(){const e=O(this.board);if(!e.every(s=>s.every(a=>a>0))){this.gameComplete.set(!1);return}if(this.findViolatedCells(e).length>0){this.gameComplete.set(!1);return}this.gameComplete.set(!0)}updateState(e){this.state.update(l=>{const t=e(l),s=O(this.timeStart),a=O(this.timePass)+(Date.now()-s)/1e3;return me.saveCurrentGame(this.initialBoard,t,a),t})}}function O(r){let e;return r.subscribe(t=>{e=t})(),e}var rt=N('<div class="overlay svelte-5jfzgt"><div class="complete-card svelte-5jfzgt"><h2 class="svelte-5jfzgt">Puzzle Completed!</h2> <p class="svelte-5jfzgt"> </p> <button class="new-game-btn svelte-5jfzgt">New Game</button></div></div>');function nt(r,e){K(e,!1);let l=_(e,"levelId",8);function t(){_e($("/"))}F();var s=rt(),a=g(s),c=x(g(a),2),d=g(c);b(c);var o=x(c,2);b(a),b(s),T(()=>ee(d,`Congratulations! You've successfully completed the ${l()??""} puzzle.`)),q("click",o,t),M(r,s),W()}var ct=N('<div class="header svelte-1eechvy"><button class="back-btn svelte-1eechvy">Back</button> <div class="title svelte-1eechvy"><h1 class="svelte-1eechvy"> </h1> <h2 class="svelte-1eechvy"> </h2></div> <button class="clear-btn svelte-1eechvy">Reset</button></div>');function dt(r,e){K(e,!1);const l=k();let t=_(e,"levelId",8);const s=ne();let a=k(0);function c(){_e($("/"))}function d(){s.clearBoard()}re(()=>{const B=setInterval(()=>{ze(a)},1e3),y=s.timePass.subscribe(V=>{S(a,V)});return()=>{clearInterval(B),y()}}),ie(()=>i(a),()=>{S(l,new Date(i(a)*1e3).toISOString().substr(11,8))}),de(),F();var o=ct(),n=g(o),h=x(n,2),v=g(h),C=g(v,!0);b(v);var w=x(v,2),p=g(w,!0);b(w),b(h);var A=x(h,2);b(o),T(()=>{ee(C,pe[t()].name),ee(p,i(l))}),q("click",n,c),q("click",A,d),M(r,o),W()}var ut=N('<div><!> <div><div><!></div> <div class="controls-container svelte-1lnc43"><!></div></div> <!></div>');function vt(r,e){K(e,!1);const l=k();let t=_(e,"levelId",8),s=_(e,"initialBoard",8);const a=new it;a.init(t(),s()),Oe(a);let c=k([]),d=k([]),o=k({row:-1,col:-1}),n=k(Array(9).fill(0)),h=k(!1),v=k(!1),C=k(0),w=k(0);re(()=>{const f=a.board.subscribe(j=>{S(c,j)}),D=a.notes.subscribe(j=>{S(d,j)}),Y=a.selectedCell.subscribe(j=>{S(o,j)}),X=a.digitCounts.subscribe(j=>{S(n,j)}),Q=a.gameComplete.subscribe(j=>{S(h,j)});return()=>{f(),D(),Y(),X(),Q()}});function p(f,D){i(o).row===-1||i(o).col===-1?(G(o,i(o).row=0),G(o,i(o).col=0)):(G(o,i(o).row+=f),G(o,i(o).col+=D)),i(o).row<0&&G(o,i(o).row=8),i(o).row>8&&G(o,i(o).row=0),i(o).col<0&&G(o,i(o).col=8),i(o).col>8&&G(o,i(o).col=0),a.selectCell(i(o).row,i(o).col)}function A(f){if(!i(h))if(f.key.match(/[1-9]/)){const D=parseInt(f.key,10);a.enterDigit(D)}else f.key==="Backspace"?a.clearSelectedCell():f.key==="Enter"?a.toggleNoteMode():f.key==="ArrowUp"?p(-1,0):f.key==="ArrowDown"?p(1,0):f.key==="ArrowLeft"?p(0,-1):f.key==="ArrowRight"&&p(0,1)}ie(()=>(i(C),i(w)),()=>{S(v,i(C)>i(w))}),ie(()=>(i(w),i(v),i(C)),()=>{S(l,i(w)>0&&!i(v)&&i(C)/i(w)>.65)}),de(),F();var B=ut();q("keydown",De,A);let y;var V=g(B);dt(V,{get levelId(){return t()}});var u=x(V,2);let m;var E=g(u);let L;var P=g(E);Qe(P,{get board(){return i(c)},get notes(){return i(d)},get selectedCell(){return i(o)}}),b(E);var z=x(E,2),J=g(z);at(J,{get digitCounts(){return i(n)}}),b(z),b(u);var ue=x(u,2);{var te=f=>{nt(f,{get levelId(){return t()}})};se(ue,f=>{i(h)&&f(te)})}b(B),T((f,D,Y)=>{y=H(B,1,"container svelte-1lnc43",null,y,f),m=H(u,1,"game-content svelte-1lnc43",null,m,D),L=H(E,1,"board-container svelte-1lnc43",null,L,Y)},[()=>({"wide-layout":i(v)}),()=>({"wide-layout":i(v)}),()=>({"square-layout":i(l)})],U),be("innerWidth",f=>S(C,f)),be("innerHeight",f=>S(w,f)),M(r,B),W()}function St(r,e){K(e,!1);let l=_(e,"data",8);F(),Te(t=>{T(()=>Pe.title=`Sudoku 1024: ${pe[l().levelId].name??""}`)}),vt(r,{get levelId(){return l().levelId},get initialBoard(){return l().board}}),W()}export{St as component,yt as universal};
