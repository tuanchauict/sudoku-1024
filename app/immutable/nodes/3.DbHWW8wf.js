var Be=Object.defineProperty;var Ie=(o,e,l)=>e in o?Be(o,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[e]=l;var B=(o,e,l)=>Ie(o,typeof e!="symbol"?e+"":e,l);import{b as Ne,d as Ae,g as Ve,a as F,e as Z,i as $,c as Ee,f as we,L as pe}from"../chunks/BR8rzHFG.js";import{R as xe,w as K,d as J,g as Ce}from"../chunks/C_RvfIbx.js";import{t as V,a as S,c as ce,n as Se}from"../chunks/BdziLC_p.js";import{i as H}from"../chunks/CtBiNhbk.js";import{o as ue,aG as ze,aH as Pe,s as R,aI as ee,D as _,aJ as y,f as oe,aK as ie,w as g,x as h,t as L,V as T,g as n,v as O,q as de,y as P,aa as ve,aL as Ge,aM as Ue,ab as qe}from"../chunks/BCWV8hfl.js";import{l as De,w as Le,e as D,s as W,h as Te}from"../chunks/DkYXUU7v.js";import{p as A,i as Q}from"../chunks/DP-PKcU7.js";import{o as te}from"../chunks/D3_g4ptc.js";function j(o,e,l,t,s,a){var i=o.__className;if(ue||i!==l){var u=Ne(l,t,a);(!ue||u!==o.getAttribute("class"))&&(u==null?o.removeAttribute("class"):o.className=u),o.__className=l}else if(a&&s!==a)for(var r in a){var d=!!a[r];(s==null||d!==!!s[r])&&o.classList.toggle(r,d)}return a}function fe(o,e){De(window,["resize"],()=>Le(()=>e(window[o])))}function je(o){const e=Ae(o);if(e===null||e.length!==81)return null;const l=[];for(let t=0;t<9;t++){const s=[];for(let a=0;a<9;a++)s.push(e[t*9+a]);l.push(s)}return l}function X(o,e){throw new xe(o,e.toString())}new TextEncoder;const He=({url:o})=>{const e=o.searchParams.get("game");if(!e)throw X(303,F("/"));const l=parseInt(e[0]);if(isNaN(l)||l<1||l>4)throw X(303,F("/"));const t=l;if(!t)throw X(303,F("/"));let s=e.substring(1);const a=s?je(s):null;if(!a)throw s=Ve.generateBoardString(t),X(303,`play?game=${l}${s}`);return{levelId:t,board:a}},It=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"})),_e=Symbol("sudoku-view-model");function Re(o){ze(_e,o)}function le(){return Pe(_e)}var Oe=V('<span class="cell-value svelte-akfsra"> </span>'),Ke=V('<div class="note-cell svelte-akfsra"><span class="note-value svelte-akfsra"></span></div>'),Je=V('<div class="notes-grid svelte-akfsra"></div>'),Fe=V("<div><!></div>");function We(o,e){R(e,!1);const l=y();let t=A(e,"rowIndex",8),s=A(e,"colIndex",8),a=A(e,"cellValue",8),i=A(e,"isInitial",8),u=A(e,"notes",8),r=A(e,"selectedCell",8),d=A(e,"valueCounts",8),I=A(e,"violatedCells",8);const b=le();function w(v,C){return b.isSameBox(v,C)}function k(v,C){return b.hasSameValue(v,C)}ee(()=>(oe(I()),oe(t()),oe(s())),()=>{_(l,I().some(v=>v.row===t()&&v.col===s()))}),ie(),H();var f=Fe();let p;var N=g(f);{var E=v=>{var C=Oe(),U=g(C,!0);h(C),L(()=>W(U,a())),S(v,C)},G=v=>{var C=ce(),U=de(C);{var x=M=>{var c=Je();Z(c,4,()=>Array(9).fill(null),$,(z,m,Y)=>{var ne=ce(),ye=de(ne);{var ke=se=>{var ae=Ke(),Me=g(ae);Me.textContent=Y+1,h(ae),S(se,ae)};Q(ye,se=>{u()[Y]&&se(ke)})}S(z,ne)}),h(c),S(M,c)};Q(U,M=>{u().some(c=>c)&&M(x)})}S(v,C)};Q(N,v=>{a()?v(E):v(G,!1)})}h(f),L(v=>p=j(f,1,"cell svelte-akfsra",null,p,v),[()=>({selected:r().row===t()&&r().col===s(),"same-line":r().row===t()||r().col===s(),"same-box":w(t(),s())&&!(r().row===t()&&r().col===s()),"same-value":k(t(),s())&&!(r().row===t()&&r().col===s()),complete:a()&&d()[a()]>=9,violated:n(l),initial:i()})],T),D("click",f,()=>b.selectCell(t(),s())),S(o,f),O()}var Ye=V("<div><!></div>"),Xe=V('<div class="row svelte-1iqdaqq"></div>'),Qe=V('<div class="sudoku-board svelte-1iqdaqq"></div>');function Ze(o,e){R(e,!1);let l=y([]),t=y([]),s=y({row:-1,col:-1});const a=le();let i=y([]),u=y([]);te(()=>{const d=a.board.subscribe(f=>{_(l,f)}),I=a.notes.subscribe(f=>{_(t,f)}),b=a.selectedCell.subscribe(f=>{_(s,f)}),w=a.valueCounts.subscribe(f=>{_(i,f)}),k=a.violatedCells.subscribe(f=>{_(u,f)});return()=>{d(),I(),b(),w(),k()}}),H();var r=Qe();Z(r,5,()=>n(l),$,(d,I,b)=>{var w=Xe();Z(w,5,()=>n(I),$,(k,f,p)=>{var N=Ye();j(N,1,"cell svelte-1iqdaqq",null,{},{"border-bottom-thick":b%3===2&&b<8,"border-right-thick":p%3===2&&p<8});var E=g(N);const G=T(()=>a.isInitial(b,p));We(E,{rowIndex:b,colIndex:p,get cellValue(){return n(f)},get isInitial(){return n(G)},get notes(){return n(t)[b][p]},get selectedCell(){return n(s)},get valueCounts(){return n(i)},get violatedCells(){return n(u)}}),h(N),S(k,N)}),h(w),S(d,w)}),h(r),S(o,r),O()}var $e=Se('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>');function et(o){var e=$e();S(o,e)}var tt=V('<div class="container svelte-1kzvdff"><p class="tip svelte-1kzvdff">Tip: Select a cell and press 1-9 to enter values. Use note mode for candidates.</p> <p class="tip svelte-1kzvdff">Any issue or suggestion? <br>Please report on <a href="https://github.com/tuanchauict/sudoku-1024/" target="_blank">GitHub</a> of the project.</p></div>');function lt(o){var e=tt();S(o,e)}var st=Se('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" stroke="none" viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"></path></svg>');function at(o){var e=st();S(o,e)}var ot=V("<button> </button>"),rt=V('<div class="container svelte-1l8nhu6"><div class="digits-container svelte-1l8nhu6"><!> <button class="btn digit-button clear-btn svelte-1l8nhu6"><span>&#10005;</span></button></div> <div class="actions-container svelte-1l8nhu6"><button class="btn action-button svelte-1l8nhu6"><!> <span>Undo</span></button> <button><!> <span>Note</span></button></div> <!></div>');function it(o,e){R(e,!1);let l=y(Array(10).fill(0)),t=y(!1),s=y(!0),a=y(!1);const i=le();function u(v){i.enterDigit(v)}te(()=>{const v=i.noteMode.subscribe(M=>{_(t,M)}),C=i.cellEditable.subscribe(M=>{_(s,M)}),U=i.canUndo.subscribe(M=>{_(a,M)}),x=i.valueCounts.subscribe(M=>{_(l,M)});return()=>{v(),C(),U(),x()}}),H();var r=rt(),d=g(r),I=g(d);Z(I,0,()=>Array(9).fill(null),$,(v,C,U)=>{var x=ot();const M=T(()=>U+1),c=T(()=>n(l)[U+1]);let z;var m=g(x,!0);h(x),L(Y=>{z=j(x,1,"btn digit-button svelte-1l8nhu6",null,z,Y),x.disabled=n(c)>=9,W(m,n(M))},[()=>({disabled:n(c)>=9})],T),D("click",x,()=>u(n(M))),S(v,x)});var b=P(I,2);h(d);var w=P(d,2),k=g(w),f=g(k);at(f),ve(2),h(k);var p=P(k,2);let N;var E=g(p);et(E),ve(2),h(p),h(w);var G=P(w,2);lt(G),h(r),L(v=>{b.disabled=!n(s),k.disabled=!n(a),N=j(p,1,"btn action-button note-btn svelte-1l8nhu6",null,N,v)},[()=>({active:n(t)})],T),D("click",b,()=>i.clearSelectedCell()),D("click",k,()=>i.undo()),D("click",p,()=>i.toggleNoteMode()),S(o,r),O()}const nt="sudoku";class he{static saveCurrentGame(e,l,t){const s={state:l,timePass:t};localStorage.setItem(be(e),JSON.stringify(s))}static loadCurrentGame(e){const l=localStorage.getItem(be(e));if(!l)return null;const t=JSON.parse(l);return t.state?t:null}}function be(o){const e=o.flatMap(l=>l);return`${nt}_${Ee(e)}`}function re(o,e){return JSON.stringify(o)===JSON.stringify(e)}function q(o){let e;return o.subscribe(t=>{e=t})(),e}function me(o){const e=[],l=(t,s)=>e.some(a=>a.row===t&&a.col===s);for(let t=0;t<9;t++)for(let s=0;s<9;s++){const a=o[t][s];if(!a||l(t,s))continue;for(let r=0;r<9;r++)r!==s&&o[t][r]===a&&(l(t,s)||e.push({row:t,col:s}),l(t,r)||e.push({row:t,col:r}));for(let r=0;r<9;r++)r!==t&&o[r][s]===a&&(l(t,s)||e.push({row:t,col:s}),l(r,s)||e.push({row:r,col:s}));const i=Math.floor(t/3)*3,u=Math.floor(s/3)*3;for(let r=i;r<i+3;r++)for(let d=u;d<u+3;d++)(r!==t||d!==s)&&o[r][d]===a&&(l(t,s)||e.push({row:t,col:s}),l(r,d)||e.push({row:r,col:d}))}return e}function ct(o,e){let l=0,t=0;for(let s=0;s<9;s++)for(let a=0;a<9;a++)if(e.board[s][a]!==o.board[s][a]||!re(e.notes[s][a],o.notes[s][a])){l=s,t=a;break}return{row:l,col:t}}function ut(o){const e=Array(10).fill(0);for(let l=0;l<9;l++)for(let t=0;t<9;t++)o[l][t]&&e[o[l][t]]++;return e}const ge=we(0,Array(9).fill(Array(9).fill(0)));class dt{constructor(){B(this,"initialBoard",ge.initialBoard);B(this,"state",K(ge));B(this,"stateHistoryStack",[]);B(this,"board");B(this,"notes");B(this,"selectedCell");B(this,"noteMode",K(!1));B(this,"valueCounts");B(this,"cellEditable");B(this,"violatedCells");B(this,"gameComplete",K(!1));B(this,"timePass",K(0));B(this,"timeStart",K(Date.now()));B(this,"canUndo",K(!1));this.board=J(this.state,e=>e.board),this.notes=J(this.state,e=>e.notes),this.selectedCell=J(this.state,e=>e.selectedCell),this.valueCounts=J(this.board,e=>ut(e)),this.cellEditable=J(this.selectedCell,e=>this.isEditableCell(e.row,e.col)),this.violatedCells=J(this.board,e=>me(e))}init(e,l){const t=he.loadCurrentGame(l),s=t?t.state:we(e,l);this.state.set(s),this.initialBoard=l,this.stateHistoryStack.length=0,this.timePass.set(t?t.timePass:0),this.timeStart.set(Date.now())}get isInNodeMode(){return q(this.noteMode)}clearBoard(){this.updateState(e=>({...e,board:this.initialBoard,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),noteMode:!1})),this.gameComplete.set(!1)}selectCell(e,l){this.updateState(t=>({...t,selectedCell:{row:e,col:l}}))}toggleNoteMode(){this.noteMode.set(!this.isInNodeMode)}enterDigit(e){this.updateState(l=>{const{row:t,col:s}=l.selectedCell;if(!this.isEditableCell(t,s))return l;const a=[...l.board.map(u=>[...u])],i=[...l.notes.map(u=>[...u.map(r=>[...r])])];return this.isInNodeMode?i[t][s][e-1]=!i[t][s][e-1]:a[t][s]=e,{...l,board:a,notes:i}}),this.updateCompleteState()}clearSelectedCell(){this.updateState(e=>{const{row:l,col:t}=e.selectedCell;if(!this.isEditableCell(l,t))return e;const s=[...e.board.map(i=>[...i])],a=[...e.notes.map(i=>[...i.map(u=>[...u])])];return s[l][t]!==0?s[l][t]=0:a[l][t]=Array(9).fill(!1),{...e,board:s,notes:a}}),this.gameComplete.set(!1)}undo(){const e=this.stateHistoryStack.pop();e&&(this.state.set({...e,selectedCell:ct(e,q(this.state))}),this.canUndo.set(this.stateHistoryStack.length>0))}isInitial(e,l){return this.initialBoard[e][l]!==0}isSameBox(e,l){const t=q(this.selectedCell);if(!t||t.row===-1||t.col===-1)return!1;const s=Math.floor(e/3),a=Math.floor(l/3),i=Math.floor(t.row/3),u=Math.floor(t.col/3);return s===i&&a===u}hasSameValue(e,l){const t=q(this.selectedCell),s=q(this.board);if(!t||!s||t.row===-1||t.col===-1)return!1;const a=s[t.row][t.col];return!!(a&&s[e][l]===a)}isEditableCell(e,l){return e===-1||l===-1?!1:this.initialBoard[e][l]===0}updateCompleteState(){const e=q(this.board);if(!e.every(s=>s.every(a=>a>0))){this.gameComplete.set(!1);return}if(me(e).length>0){this.gameComplete.set(!1);return}this.gameComplete.set(!0)}updateState(e){this.state.update(l=>{const t=e(l),s=q(this.timeStart),a=q(this.timePass)+(Date.now()-s)/1e3;return he.saveCurrentGame(this.initialBoard,t,a),re(l.board,t.board)&&re(l.notes,t.notes)||(this.stateHistoryStack.push(l),this.canUndo.set(!0)),t})}}var vt=V('<div class="overlay svelte-5jfzgt"><div class="complete-card svelte-5jfzgt"><h2 class="svelte-5jfzgt">Puzzle Completed!</h2> <p class="svelte-5jfzgt"> </p> <button class="new-game-btn svelte-5jfzgt">New Game</button></div></div>');function ft(o,e){R(e,!1);let l=A(e,"levelId",8);function t(){Ce(F("/"))}H();var s=vt(),a=g(s),i=P(g(a),2),u=g(i);h(i);var r=P(i,2);h(a),h(s),L(()=>W(u,`Congratulations! You've successfully completed the ${l()??""} puzzle.`)),D("click",r,t),S(o,s),O()}var ht=V('<div class="header svelte-1eechvy"><button class="back-btn svelte-1eechvy">Back</button> <div class="title svelte-1eechvy"><h1 class="svelte-1eechvy"> </h1> <h2 class="svelte-1eechvy"> </h2></div> <button class="clear-btn svelte-1eechvy">Reset</button></div>');function bt(o,e){R(e,!1);const l=y();let t=A(e,"levelId",8);const s=le();let a=y(0),i=!1;function u(){Ce(F("/"))}function r(){s.clearBoard()}te(()=>{const E=setInterval(()=>{i||Ge(a)},1e3),G=s.timePass.subscribe(C=>{_(a,C)}),v=s.gameComplete.subscribe(C=>{i=C});return()=>{clearInterval(E),G(),v()}}),ee(()=>n(a),()=>{_(l,new Date(n(a)*1e3).toISOString().substr(11,8))}),ie(),H();var d=ht(),I=g(d),b=P(I,2),w=g(b),k=g(w,!0);h(w);var f=P(w,2),p=g(f,!0);h(f),h(b);var N=P(b,2);h(d),L(()=>{W(k,pe[t()].name),W(p,n(l))}),D("click",I,u),D("click",N,r),S(o,d),O()}var mt=V('<div><!> <div><div><!></div> <div class="controls-container svelte-1lnc43"><!></div></div> <!></div>');function gt(o,e){R(e,!1);const l=y();let t=A(e,"levelId",8),s=A(e,"initialBoard",8);const a=new dt;a.init(t(),s()),Re(a);let i=y(!1),u=y(!1),r=y(0),d=y(0);te(()=>{const c=a.gameComplete.subscribe(z=>{_(i,z)});return()=>{c()}});function I(c){if(!n(i))if(c.key.match(/[1-9]/)){const z=parseInt(c.key,10);a.enterDigit(z)}else c.key==="Backspace"?a.clearSelectedCell():c.key==="Enter"||c.key===" "?a.toggleNoteMode():c.key==="ArrowUp"?b(-1,0):c.key==="ArrowDown"?b(1,0):c.key==="ArrowLeft"?b(0,-1):c.key==="ArrowRight"?b(0,1):c.key==="z"&&(c.ctrlKey||c.metaKey)&&a.undo()}function b(c,z){const m=q(a.selectedCell);m.row===-1||m.col===-1?(m.row=0,m.col=0):(m.row+=c,m.col+=z),m.row<0&&(m.row=8),m.row>8&&(m.row=0),m.col<0&&(m.col=8),m.col>8&&(m.col=0),a.selectCell(m.row,m.col)}ee(()=>(n(r),n(d)),()=>{_(u,n(r)>n(d)||n(r)>650)}),ee(()=>(n(d),n(u),n(r)),()=>{_(l,n(d)>0&&!n(u)&&n(r)/n(d)>.65)}),ie(),H();var w=mt();D("keydown",Ue,I);let k;var f=g(w);bt(f,{get levelId(){return t()}});var p=P(f,2);let N;var E=g(p);let G;var v=g(E);Ze(v,{}),h(E);var C=P(E,2),U=g(C);it(U,{}),h(C),h(p);var x=P(p,2);{var M=c=>{ft(c,{get levelId(){return t()}})};Q(x,c=>{n(i)&&c(M)})}h(w),L((c,z,m)=>{k=j(w,1,"container svelte-1lnc43",null,k,c),N=j(p,1,"game-content svelte-1lnc43",null,N,z),G=j(E,1,"board-container svelte-1lnc43",null,G,m)},[()=>({"wide-layout":n(u)}),()=>({"wide-layout":n(u)}),()=>({"square-layout":n(l)})],T),fe("innerWidth",c=>_(r,c)),fe("innerHeight",c=>_(d,c)),S(o,w),O()}function Nt(o,e){R(e,!1);let l=A(e,"data",8);H(),Te(t=>{L(()=>qe.title=`Sudoku 1024: ${pe[l().levelId].name??""}`)}),gt(o,{get levelId(){return l().levelId},get initialBoard(){return l().board}}),O()}export{Nt as component,It as universal};
