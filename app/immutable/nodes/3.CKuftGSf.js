var _e=Object.defineProperty;var Se=(i,e,s)=>e in i?_e(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var I=(i,e,s)=>Se(i,typeof e!="symbol"?e+"":e,s);import{a as ye,d as Be,g as ke,e as ee,i as te,b as Me}from"../chunks/CypQxr5q.js";import{R as Ae,w as ae,d as T,g as me,b as Ce}from"../chunks/CzULvS-x.js";import{t as N,a as y,c as de,n as Ie}from"../chunks/COzuYKpT.js";import{i as j}from"../chunks/DHde-cKe.js";import{o as ue,aE as Ne,aF as xe,s as F,aG as le,D as k,aH as S,f as re,aI as ie,w as m,x as h,t as U,W as O,g as r,v as K,q as ve,ap as we,y as E,aJ as Ve,aK as Ee,aL as z}from"../chunks/BPwp6ig8.js";import{p as _,i as $}from"../chunks/B6SuufE-.js";import{l as Pe,w as Ge,e as R,s as Q}from"../chunks/jKAJhQlT.js";import{o as se}from"../chunks/BDZNdOtR.js";function H(i,e,s,t,o,l){var c=i.__className;if(ue||c!==s){var d=ye(s,t,l);(!ue||d!==i.getAttribute("class"))&&(d==null?i.removeAttribute("class"):i.className=d),i.__className=s}else if(l&&o!==l)for(var a in l){var n=!!l[a];(o==null||n!==!!o[a])&&i.classList.toggle(a,n)}return l}function fe(i,e){Pe(window,["resize"],()=>Ge(()=>e(window[i])))}function De(i){const e=Be(i);if(e===null||e.length!==81)return null;const s=[];for(let t=0;t<9;t++){const o=[];for(let l=0;l<9;l++)o.push(e[t*9+l]);s.push(o)}return s}function be(i,e){throw new Ae(i,e.toString())}new TextEncoder;const qe=({url:i})=>{const e=i.searchParams.get("level");if(!e)throw be(303,"/");let s=i.searchParams.get("board");const t=s?De(s):null;if(!t)throw s=ke.generateBoardString(e),be(303,`play?level=${e}&board=${s}`);return{levelId:e,board:t}},gt=Object.freeze(Object.defineProperty({__proto__:null,load:qe},Symbol.toStringTag,{value:"Module"})),pe=Symbol("sudoku-view-model");function ze(i){Ne(pe,i)}function oe(){return xe(pe)}var Re=N('<span class="cell-value svelte-dax43i"> </span>'),Le=N('<div class="note-cell svelte-dax43i"><span class="note-value svelte-dax43i"></span></div>'),Te=N('<div class="notes-grid svelte-dax43i"></div>'),Oe=N("<div><!></div>");function He(i,e){F(e,!1);const s=S();let t=_(e,"rowIndex",8),o=_(e,"colIndex",8),l=_(e,"cellValue",8),c=_(e,"isInitial",8),d=_(e,"notes",8),a=_(e,"selectedCell",8),n=_(e,"valueCounts",8),b=_(e,"violatedCells",8);const v=oe();function w(u,g){return v.isSameBox(u,g)}function C(u,g){return v.hasSameValue(u,g)}le(()=>(re(b()),re(t()),re(o())),()=>{k(s,b().some(u=>u.row===t()&&u.col===o()))}),ie(),j();var p=Oe();let M;var B=m(p);{var A=u=>{var g=Re(),x=m(g,!0);h(g),U(()=>Q(x,l())),y(u,g)},G=u=>{var g=de(),x=ve(g);{var L=q=>{var P=Te();ee(P,4,()=>Array(9).fill(null),te,(W,ce,Z)=>{var f=de(),D=ve(f);{var J=X=>{var Y=Le(),V=m(Y);V.textContent=Z+1,h(Y),y(X,Y)};$(D,X=>{d()[Z]&&X(J)})}y(W,f)}),h(P),y(q,P)};$(x,q=>{d().some(P=>P)&&q(L)})}y(u,g)};$(B,u=>{l()?u(A):u(G,!1)})}h(p),U(u=>M=H(p,1,"cell svelte-dax43i",null,M,u),[()=>({selected:a().row===t()&&a().col===o(),"same-line":a().row===t()||a().col===o(),"same-box":w(t(),o())&&!(a().row===t()&&a().col===o()),"same-value":C(t(),o())&&!(a().row===t()&&a().col===o()),complete:l()&&n()[l()]>=9,violated:r(s),initial:c()})],O),R("click",p,()=>v.selectCell(t(),o())),y(i,p),K()}var Ue=N("<div><!></div>"),je=N('<div class="row svelte-1iqdaqq"></div>'),Fe=N('<div class="sudoku-board svelte-1iqdaqq"></div>');function Ke(i,e){F(e,!1);let s=_(e,"board",24,()=>[]),t=_(e,"notes",24,()=>[]),o=_(e,"selectedCell",24,()=>({row:-1,col:-1}));const l=oe();let c=S([]),d=S([]);se(()=>{const n=l.valueCounts.subscribe(v=>{k(c,v)}),b=l.violatedCells.subscribe(v=>{k(d,v)});return()=>{n(),b()}}),j();var a=Fe();ee(a,5,s,te,(n,b,v)=>{var w=je();ee(w,5,()=>r(b),te,(C,p,M)=>{var B=Ue();H(B,1,"cell svelte-1iqdaqq",null,{},{"border-bottom-thick":v%3===2&&v<8,"border-right-thick":M%3===2&&M<8});var A=m(B);const G=O(()=>l.initialBoard[v][M]!==0);He(A,{rowIndex:v,colIndex:M,get cellValue(){return r(p)},get isInitial(){return r(G)},get notes(){return t()[v][M]},get selectedCell(){return o()},get valueCounts(){return r(c)},get violatedCells(){return r(d)}}),h(B),y(C,B)}),h(w),y(n,w)}),h(a),y(i,a),K()}var We=Ie('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>');function Je(i){var e=We();y(i,e)}var Xe=N('<div class="tip svelte-1h2zn7p">Tip: Select a cell and press 1-9 to enter values. Use note mode for candidates.</div> <div class="tip svelte-1h2zn7p">Any issue or suggestion? Please report on <a href="https://github.com/tuanchauict/sudoku-1024/">GitHub</a> of the project.</div>',1);function Ye(i){var e=Xe();we(2),y(i,e)}var Qe=N("<button> </button>"),Ze=N('<div class="container svelte-1d01rdo"><div class="digits-container svelte-1d01rdo"><!> <button class="digit-button clear-btn svelte-1d01rdo"><span>&#10005;</span></button></div> <div class="actions-container svelte-1d01rdo"><button><!> <span>Note</span></button></div> <!></div>');function $e(i,e){F(e,!1);let s=_(e,"digitCounts",24,()=>Array(9).fill(0)),t=S(!1),o=S(!0);const l=oe();function c(A){l.enterDigit(A)}function d(){l.toggleNoteMode()}se(()=>{const A=l.noteMode.subscribe(u=>{k(t,u)}),G=l.cellEditable.subscribe(u=>{k(o,u)});return()=>{A(),G()}}),j();var a=Ze(),n=m(a),b=m(n);ee(b,0,()=>Array(9).fill(null),te,(A,G,u)=>{var g=Qe();const x=O(()=>u+1),L=O(()=>s()[u]);let q;var P=m(g,!0);h(g),U(W=>{q=H(g,1,"digit-button svelte-1d01rdo",null,q,W),g.disabled=r(L)>=9,Q(P,r(x))},[()=>({disabled:r(L)>=9})],O),R("click",g,()=>c(r(x))),y(A,g)});var v=E(b,2);h(n);var w=E(n,2),C=m(w);let p;var M=m(C);Je(M),we(2),h(C),h(w);var B=E(w,2);Ye(B),h(a),U(A=>{v.disabled=!r(o),p=H(C,1,"action-button note-btn svelte-1d01rdo",null,p,A)},[()=>({active:r(t)})],O),R("click",v,()=>l.clearSelectedCell()),R("click",C,d),y(i,a),K()}const et="sudoku";class he{static saveCurrentGame(e,s,t){const o={state:s,timePass:t};localStorage.setItem(ge(e),JSON.stringify(o))}static loadCurrentGame(e){const s=localStorage.getItem(ge(e));if(!s)return null;const t=JSON.parse(s);return t.state?t:null}}function ge(i){const e=i.flatMap(s=>s);return`${et}_${Me(e)}`}class ne{constructor(e,s){I(this,"state");I(this,"board");I(this,"notes");I(this,"selectedCell");I(this,"noteMode",ae(!1));I(this,"digitCounts");I(this,"valueCounts");I(this,"cellEditable");I(this,"violatedCells");I(this,"gameComplete");I(this,"timePass");I(this,"timeStart",Date.now());this.levelId=e,this.initialBoard=s;const t=he.loadCurrentGame(s),o=t?t.state:ne.createState(s);this.timePass=t?t.timePass:0,this.state=ae(o),this.board=T(this.state,l=>l.board),this.notes=T(this.state,l=>l.notes),this.selectedCell=T(this.state,l=>l.selectedCell),this.digitCounts=T(this.board,l=>this.calculateDigitCounts(l)),this.valueCounts=T(this.board,l=>this.calculateValueCounts(l)),this.cellEditable=T(this.selectedCell,l=>this.isEditableCell(l.row,l.col)),this.violatedCells=T(this.board,l=>this.findViolatedCells(l)),this.gameComplete=ae(!1)}static createState(e){return{board:e,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),selectedCell:{row:-1,col:-1}}}get currentGameState(){let e;return this.state.subscribe(t=>{})(),e}get isInNodeMode(){let e=!1;return this.noteMode.subscribe(t=>{e=t})(),e}get currentSelectedCell(){let e={row:-1,col:-1};return this.selectedCell.subscribe(t=>{e=t})(),e}get currentBoard(){let e=this.initialBoard;return this.board.subscribe(t=>{e=t})(),e}clearBoard(){this.updateState(e=>({...e,board:this.initialBoard,notes:Array(9).fill(null).map(()=>Array(9).fill(null).map(()=>Array(9).fill(!1))),selectedCell:{row:-1,col:-1},noteMode:!1})),this.gameComplete.set(!1)}selectCell(e,s){this.updateState(t=>({...t,selectedCell:{row:e,col:s}}))}toggleNoteMode(){this.noteMode.set(!this.isInNodeMode)}enterDigit(e){this.updateState(s=>{const{row:t,col:o}=s.selectedCell;if(!this.isEditableCell(t,o))return s;const l=[...s.board.map(d=>[...d])],c=[...s.notes.map(d=>[...d.map(a=>[...a])])];return this.isInNodeMode?c[t][o][e-1]=!c[t][o][e-1]:l[t][o]=e,{...s,board:l,notes:c}}),this.updateCompleteState()}clearSelectedCell(){this.updateState(e=>{const{row:s,col:t}=e.selectedCell;if(!this.isEditableCell(s,t))return e;const o=[...e.board.map(c=>[...c])],l=[...e.notes.map(c=>[...c.map(d=>[...d])])];return o[s][t]!==0?o[s][t]=0:l[s][t]=Array(9).fill(!1),{...e,board:o,notes:l}}),this.gameComplete.set(!1)}calculateDigitCounts(e){const s=Array(9).fill(0);for(let t=0;t<9;t++)for(let o=0;o<9;o++)e[t][o]>0&&s[e[t][o]-1]++;return s}calculateValueCounts(e){const s=Array(10).fill(0);for(let t=0;t<9;t++)for(let o=0;o<9;o++)e[t][o]&&s[e[t][o]]++;return s}isSameBox(e,s){let t=this.currentSelectedCell;if(!t||t.row===-1||t.col===-1)return!1;const o=Math.floor(e/3),l=Math.floor(s/3),c=Math.floor(t.row/3),d=Math.floor(t.col/3);return o===c&&l===d}hasSameValue(e,s){let t=this.currentSelectedCell,o=this.currentBoard;if(!t||!o||t.row===-1||t.col===-1)return!1;const l=o[t.row][t.col];return!!(l&&o[e][s]===l)}isEditableCell(e,s){return e===-1||s===-1?!1:this.initialBoard[e][s]===0}findViolatedCells(e){const s=[],t=(o,l)=>s.some(c=>c.row===o&&c.col===l);for(let o=0;o<9;o++)for(let l=0;l<9;l++){const c=e[o][l];if(!c||t(o,l))continue;for(let n=0;n<9;n++)n!==l&&e[o][n]===c&&(t(o,l)||s.push({row:o,col:l}),t(o,n)||s.push({row:o,col:n}));for(let n=0;n<9;n++)n!==o&&e[n][l]===c&&(t(o,l)||s.push({row:o,col:l}),t(n,l)||s.push({row:n,col:l}));const d=Math.floor(o/3)*3,a=Math.floor(l/3)*3;for(let n=d;n<d+3;n++)for(let b=a;b<a+3;b++)(n!==o||b!==l)&&e[n][b]===c&&(t(o,l)||s.push({row:o,col:l}),t(n,b)||s.push({row:n,col:b}))}return s}updateCompleteState(){let e=this.currentBoard;if(!e.every(o=>o.every(l=>l>0))){this.gameComplete.set(!1);return}if(this.findViolatedCells(e).length>0){this.gameComplete.set(!1);return}this.gameComplete.set(!0)}updateState(e){this.state.update(s=>{const t=e(s),o=this.timePass+(Date.now()-this.timeStart)/1e3;return he.saveCurrentGame(this.initialBoard,t,o),t})}}var tt=N('<div class="overlay svelte-e4go0s"><div class="complete-card svelte-e4go0s"><h2 class="svelte-e4go0s">Puzzle Completed!</h2> <p class="svelte-e4go0s"> </p> <button class="new-game-btn svelte-e4go0s">New Game</button></div></div>');function lt(i,e){F(e,!1);let s=_(e,"levelId",8);function t(){me(`${Ce}/`)}j();var o=tt(),l=m(o),c=E(m(l),2),d=m(c);h(c);var a=E(c,2);h(l),h(o),U(()=>Q(d,`Congratulations! You've successfully completed the ${s()??""} puzzle.`)),R("click",a,t),y(i,o),K()}var st=N('<div class="header svelte-1o91g5p"><button class="back-btn svelte-1o91g5p">Back</button> <div class="title svelte-1o91g5p"><h1 class="svelte-1o91g5p"> </h1> <h2 class="svelte-1o91g5p"> </h2></div> <button class="clear-btn svelte-1o91g5p">Reset</button></div>');function ot(i,e){F(e,!1);const s=S();let t=_(e,"levelId",8);const o=oe();let l=S(o.timePass);function c(){me(`${Ce}/`)}function d(){o.clearBoard()}se(()=>{const B=setInterval(()=>{Ve(l)},1e3);return()=>{clearInterval(B)}}),le(()=>r(l),()=>{k(s,new Date(r(l)*1e3).toISOString().substr(11,8))}),ie(),j();var a=st(),n=m(a),b=E(n,2),v=m(b),w=m(v,!0);h(v);var C=E(v,2),p=m(C,!0);h(C),h(b);var M=E(b,2);h(a),U(()=>{Q(w,t()),Q(p,r(s))}),R("click",n,c),R("click",M,d),y(i,a),K()}var at=N('<div><!> <div><div><!></div> <div class="controls-container svelte-1lnc43"><!></div></div> <!></div>');function rt(i,e){F(e,!1);const s=S();let t=_(e,"levelId",8),o=_(e,"initialBoard",8);const l=new ne(t(),o());ze(l);let c=S([]),d=S([]),a=S({row:-1,col:-1}),n=S(Array(9).fill(0)),b=S(!1),v=S(!1),w=S(0),C=S(0);se(()=>{const f=l.board.subscribe(V=>{k(c,V)}),D=l.notes.subscribe(V=>{k(d,V)}),J=l.selectedCell.subscribe(V=>{k(a,V)}),X=l.digitCounts.subscribe(V=>{k(n,V)}),Y=l.gameComplete.subscribe(V=>{k(b,V)});return()=>{f(),D(),J(),X(),Y()}});function p(f,D){r(a).row===-1||r(a).col===-1?(z(a,r(a).row=0),z(a,r(a).col=0)):(z(a,r(a).row+=f),z(a,r(a).col+=D)),r(a).row<0&&z(a,r(a).row=8),r(a).row>8&&z(a,r(a).row=0),r(a).col<0&&z(a,r(a).col=8),r(a).col>8&&z(a,r(a).col=0),l.selectCell(r(a).row,r(a).col)}function M(f){if(!r(b))if(f.key.match(/[1-9]/)){const D=parseInt(f.key,10);l.enterDigit(D)}else f.key==="Backspace"?l.clearSelectedCell():f.key==="Enter"?l.toggleNoteMode():f.key==="ArrowUp"?p(-1,0):f.key==="ArrowDown"?p(1,0):f.key==="ArrowLeft"?p(0,-1):f.key==="ArrowRight"&&p(0,1)}le(()=>(r(w),r(C)),()=>{k(v,r(w)>r(C))}),le(()=>(r(C),r(v),r(w)),()=>{k(s,r(C)>0&&!r(v)&&r(w)/r(C)>.65)}),ie(),j();var B=at();R("keydown",Ee,M);let A;var G=m(B);ot(G,{get levelId(){return t()}});var u=E(G,2);let g;var x=m(u);let L;var q=m(x);Ke(q,{get board(){return r(c)},get notes(){return r(d)},get selectedCell(){return r(a)}}),h(x);var P=E(x,2),W=m(P);$e(W,{get digitCounts(){return r(n)}}),h(P),h(u);var ce=E(u,2);{var Z=f=>{lt(f,{get levelId(){return t()}})};$(ce,f=>{r(b)&&f(Z)})}h(B),U((f,D,J)=>{A=H(B,1,"container svelte-1lnc43",null,A,f),g=H(u,1,"game-content svelte-1lnc43",null,g,D),L=H(x,1,"board-container svelte-1lnc43",null,L,J)},[()=>({"wide-layout":r(v)}),()=>({"wide-layout":r(v)}),()=>({"square-layout":r(s)})],O),fe("innerWidth",f=>k(w,f)),fe("innerHeight",f=>k(C,f)),y(i,B),K()}function mt(i,e){F(e,!1);let s=_(e,"data",8);j(),rt(i,{get levelId(){return s().levelId},get initialBoard(){return s().board}}),K()}export{mt as component,gt as universal};
